<div class="bg-account h-100 ">
  <div class="row d-flex no-block justify-content-center pt-5">
    <div class="col-5">
      <div class="card w-100 p-4">
        <form
          class="form-horizontal"
          *ngIf="form"
          [formGroup]="form"
          (ngSubmit)="submitUserAccountData()"
        >
          <div class="card-body">
            <h4 class="card-title">Información de la cuenta</h4>
            <div class="form-group row mt-4">
              <label for="name" class="col-sm-3 control-label col-form-label"
              >Nombre</label
              >
              <div class="col-sm-7">
                <input
                  type="text"
                  class="form-control"
                  id="name"
                  placeholder="Tu nombre"
                  formControlName="name"
                  pInputText
                />
                <div class="col text-danger">
                  <p *ngIf="invalidInput('name')">
                    * El nombre es obligatorio, mínimo 4 carácteres
                  </p>
                </div>
              </div>
            </div>
            <div class="form-group row">
              <label for="email" class="col-sm-3 control-label col-form-label">
                Correo electrónico
              </label>
              <div class="col-sm-7">
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  placeholder="Tu dirección de correo electrónico"
                  formControlName="email"
                  pInputText
                />
                <div class="col text-danger">
                  <p *ngIf="invalidInput('email')">
                    * El email es obligatorio y tiene que ser válido
                  </p>
                </div>
              </div>
            </div>
            <div class="form-group row">
              <label
                for="date_of_birth"
                class="col-sm-3 control-label col-form-label"
              >
                Fecha de nacimiento
              </label>
              <div class="col-sm-7">
                <p-calendar
                  [maxDate]="today"
                  formControlName="date_of_birth"
                  dateFormat="dd/mm/yy"
                  [yearNavigator]="true"
                  yearRange="1930:2021"
                  [readonlyInput]="true"
                  inputId="monthpicker"
                  [showIcon]="true"
                  id="date_of_birth"
                  inputStyleClass="p-input text-sm"
                >
                </p-calendar>
              </div>
            </div>
            <div class="form-group row mx-1 my-4">
              <div class="form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="customControlAutosizing1"
                  [checked]="change_password"
                  (change)="onToggleChangePassword()"
                  styleClass="p-input text-sm"
                />
                <label
                  class="form-check-label mb-0 font-medium"
                  for="customControlAutosizing1"
                >
                  Habilitar el cambio de contraseña
                </label>
              </div>
            </div>
            <div class="form-group row" *ngIf="change_password">
              <label
                for="password"
                class="col-sm-3 control-label col-form-label"
              >
                Cambio de contraseña
              </label>
              <div class="col-sm-6">
                <input
                  type="password"
                  class="form-control"
                  id="password"
                  placeholder="Tu nueva contraseña"
                  formControlName="password"
                  pInputText
                />
                <div class="col text-danger mt-2">
                  <p *ngIf="invalidInput('password')">
                    * La contraseña debe contener:
                  </p>
                  <ul
                    _ngcontent-cmx-c54=""
                    *ngIf="invalidInput('password') || invalidForm()"
                  >
                    <li _ngcontent-cmx-c54="">Al menos una minúscula</li>
                    <li _ngcontent-cmx-c54="">Al menos una mayúscula</li>
                    <li _ngcontent-cmx-c54="">Al menos un número</li>
                    <li _ngcontent-cmx-c54="">Mínimo 8 carácteres</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="border-top">
            <div class="card-body">
              <div class="box">
                <button
                  pButton
                  pRipple
                  type="submit"
                  label="Actualizar datos"
                  class="account-button p-button-outlined p-button-rounded projects-button"
                  icon="pi pi-send"
                ></button>
                <button
                  pButton
                  pRipple
                  type="button"
                  label="Eliminar cuenta"
                  icon="pi pi-trash"
                  class="cancel-button p-button-outlined p-button-rounded p-button-secondary"
                  [style]="{ 'margin-left': '.5em' }"
                  (click)="deleteUserAccount()"
                ></button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
    <div class="col-5">
      <div class="card w-100 p-4">
        <form
          class="form-horizontal"
          *ngIf="form"
          [formGroup]="form"
          (ngSubmit)="submitUserAccountData()"
        >
          <div class="card-body">
            <h4 class="card-title">Tus roles</h4>
            <ul>
              <li *ngFor="let role of roles">
                {{getRoleName(role)}}
              </li>
            </ul>
          </div>
          <div *ngIf="!is_requester || !is_investor" class="card-body">
            <h4 class="card-title">Obtener nuevos roles</h4>
            <div>
              <input
                type="checkbox"
                class="form-check-input d-inline-block mx-3"
                id="customControlAutosizing2"
                [checked]="obtain_requester_role"
                (change)="onChangeObtainRequesterRoleCheckbox()"
                [disabled]="is_requester"
                styleClass="p-input text-sm"
              />
              <label
                class="form-check-label mb-0 d-inline-block"
                for="customControlAutosizing2"
              >
                Solicitante
              </label>
            </div>
            <div>
              <input
                type="checkbox"
                class="form-check-input d-inline-block mx-3"
                id="customControlAutosizing3"
                [checked]="obtain_investor_role"
                (change)="onChangeObtainInvestorRoleCheckbox()"
                [disabled]="is_investor"
                styleClass="p-input text-sm"
              />
              <label
                class="form-check-label mb-0 d-inline-block"
                for="customControlAutosizing3"
              >
                Inversor
              </label>
            </div>
            <div class="my-4 mx-3">
              <ngx-stripe-card
                [options]="cardOptions"
                [elementsOptions]="elementsOptions"
              >
              </ngx-stripe-card>
            </div>
            <div class="box">
              <button
                pButton
                pRipple
                type="button"
                label="Obtener roles"
                class="account-button p-button-outlined p-button-rounded projects-button"
                icon="pi pi-send"
                [style]="{ 'margin-left': '.5em' }"
                (click)="obtainSpecialRoles()"
              ></button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <p-dialog
    header="Autenticación de doble factor"
    [(visible)]="displaying_two_factor_auth_modal"
    [modal]="true"
    [style]="{ width: '40vw' }"
    [draggable]="false"
    [resizable]="false"
  >
    <div class="card">
      <div class="p-grid p-fluid">
        <div class="p-field p-col-12">
          <label for="service_request_title">Código de verificación</label>
          <br/>
          <input
            id="service_request_title"
            type="text"
            aria-describedby="authentication_code"
            pInputText [(ngModel)]="authentication_code"
          />
          <br/>
          <small id="username1-help">Número de 6 dígitos que valida tu identidad</small
          >
        </div>
      </div>
    </div>
    <ng-template pTemplate="footer">
      <p-button
        icon="pi pi-send"
        (click)="enableTwoFactorAuthentication()"
        label="Enviar código"
        styleClass="p-button-text"
      ></p-button>
    </ng-template>
  </p-dialog>
  <div class="row d-flex no-block justify-content-center pt-5">
    <div class="col-5 mb-5">
      <div class="card w-100 p-4">
        <div class="form-group row mx-1 my-4">
          <p>{{ is_two_factor_auth_enabled ?
            'La autenticación de doble factor está habilitada. ' +
            'Para autenticarte, obtén el código de verificación de la cuenta que agregaste en Google Authenticator mediante el código QR que escaneaste.'
            : 'La autenticación de doble factor está deshabilitada'
            }}
          </p>
          <p>Ten en cuenta que una vez generas un nuevo código QR debes registrarlo con Google Authenticator para poder
            autenticarte</p>
          <div class="col-md-6">
            <button
              pButton
              pRipple
              type="button"
              label="Nuevo Código QR (Activa la autenticación de doble factor)"
              class="p-button-outlined p-button-rounded"
              icon="pi pi-refresh"
              (click)="generateQRCode()"
            ></button>
          </div>
          <div class="col-md-6">
            <button
              pButton
              pRipple
              type="button"
              label="Deshabilitar Autenticación de Doble Factor"
              class="p-button-outlined p-button-rounded"
              icon="pi pi-minus-circle"
              (click)="disableTwoFactorAuthentication()"
            ></button>
          </div>
          <div class="row align-items-center" *ngIf="qr_code">
            <img [src]="qr_code" alt="QR Code" class="w-50 mx-auto">
          </div>
          <div class="col-md-6" *ngIf="qr_code">
            <button
              pButton
              pRipple
              type="button"
              label="Validar código QR"
              class="p-button-outlined p-button-rounded"
              icon="pi pi-check-circle"
              (click)="validateQRCode()"
            ></button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
